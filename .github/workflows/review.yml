name: Review

on:
  pull_request:
    branches:
      - main

jobs:
  terraform_plan:
    name: Terraform Plans
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: AWS Org Root
      uses: ./.github/actions/terraform-plan
      with:
        account: ${{ secrets.AWS_ORG_ROOT__AWS_ACCOUNT_ID }}
        workspace: ologist-aws-org-root
        environment: root
        aws_access_key: ${{ secrets.AWS_ORG_ROOT__AWS_ACCESS_KEY }}
        aws_secret_key: ${{ secrets.AWS_ORG_ROOT__AWS_SECRET_KEY }}

    # - name: AWS Infra (Global)
    #   uses: ./.github/actions/terraform-plan
    #   with:
    #     account: ${{ secrets.aws_infra__aws_account_id}}
    #     workspace: ologist-aws-infra/global
    #     environment: root

    # - name: AWS ID (Global)
    #   uses: ./.github/actions/terraform-plan
    #   with:
    #     account: ${{ secrets.aws_id__aws_account_id}}
    #     workspace: ologist-aws-id/global
    #     environment: root

  terraform_infracost:
    name: Cost Estimate
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Infracost
      uses: ./.github/actions/terraform-infracost
      with:
          api_key: ${{ secrets.INFRACOST_API_KEY }}
